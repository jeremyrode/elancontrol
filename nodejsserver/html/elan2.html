<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Elan Control</title>
    <style>
		body {
			font-size: 64px;
		}
		.button {
			background-color: #4CAF50;
			color: white;
			text-align: center;
			text-decoration: none;
			width: 100%;
			height: 150px;
			font-size: 64px;
			margin: 4px 2px;
			cursor: pointer;	
		}
		.names {
			vertical-align: middle;
		}
		.btn-group {
			vertical-align: middle;
		}
		.grid-container {
			display: grid;
			grid-template-columns: auto 25% 20% 20%;
			grid-template-rows: 150px 150px 150px 150px 150px 150px ;
		}
		.statusspan {
			color: grey;
		}
	</style>
</head>
<body>
	<span class="statusspan" id="statusspan">Loading...</span>
	<div class="grid-container">
		<div class="btn-group"><span class="names">Master:</span></div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,10)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,10)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,10)">-</button></div>
		<div class="btn-group">Bath:</div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,6)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,6)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,6)">-</button></div>
		<div class="btn-group">Entry:</div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,9)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,9)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,9)">-</button></div>
		<div class="btn-group">Outside:</div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,7)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,7)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,7)">-</button></div>
		<div class="btn-group">Office:</div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,11)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,11)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,11)">-</button></div>
		<div class="btn-group">Kris:</div>
		<div class="btn-group"><button class="button" onclick="clickFun(0,8)">Power</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(4,8)">+</button></div>
		<div class="btn-group"><button class="button" onclick="clickFun(36,8)">-</button></div>
    </div>
    <script>
  statust = document.getElementById("statusspan");
  var connection;
  statust.innerHTML = "Jer";
  // if user is running mozilla then use it's built-in WebSocket
  window.WebSocket = window.WebSocket || window.MozWebSocket;
  if (window.WebSocket === undefined) {
    content.html($('<p>',
      { text:'Sorry, but your browser doesn\'t support WebSocket.'}
    ));
    exit()
  }
  else {
	  window.addEventListener("load", onLoad, false);
  }
  
function onLoad() {
	statust.innerHTML = "Connecting";
	connection = new WebSocket('ws://172.16.17.204:1338');
	connection.onopen = function(evt) { onOpen(evt) };
	connection.onerror = function(evt) { onError(evt) };
	connection.onmessage = function(evt) { onError(evt) };
	setInterval(function() {
    if (connection.readyState !== 1) {
      statust.innerHTML = "Connection Timeout";
      console.log('Connection Timeout');
    }
  }, 3000);
};
  
  function onOpen(evt) {
    statust.innerHTML = "Connected";
  };
  
  function onError(evt) {
    content.html($('<p>', {
      text: 'Sorry, but there\'s some problem with your connection or the server is down.'
    }));
  };
  
  function onMessage(evt) {
      console.log('Got a message:', message);
  };
 



  function clickFun(channel,command){
	  if (connection.readyState == 1) {
		  connection.send(channel + ':' + command);
		  statust.innerHTML = "Sent";
	      console.log('Got Click');
	  }
	  else {
		  console.log('Got Click, connection not ready');
		  statust.innerHTML = "Connection Error";
	  }
  };
    </script>
  </body>
</html>
