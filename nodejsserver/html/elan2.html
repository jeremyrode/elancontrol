<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Elan Control</title>
  </head>
  <body>
    <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
	  <span>Master:</span>
      <span><button id="1" class="commandbutton" onclick="clickFun(1,2)">Power</button></span>
      <span><button class="commandbutton" onclick="clickFun(1,3)">+</button></span>
      <span><button class="commandbutton" onclick="clickFun(1,4)">-</button></span>
    </div>
    <div style="display:flex; flex-direction: row; justify-content: center; align-items: center">
	  <span>Master Bath:</span>
      <span><button id="1" class="commandbutton" onclick="clickFun(1,2)">Power</button></span>
      <span><button class="commandbutton" onclick="clickFun(2,3)">+</button></span>
      <span><button class="commandbutton" onclick="clickFun(2,4)">-</button></span>
    </div>
    <p id="statusspan">Loading...</span>
    <script>
  statust = document.getElementById("statusspan");
  var connection;
  statust.innerHTML = "Jer";
  // if user is running mozilla then use it's built-in WebSocket
  window.WebSocket = window.WebSocket || window.MozWebSocket;
  if (window.WebSocket === undefined) {
    content.html($('<p>',
      { text:'Sorry, but your browser doesn\'t support WebSocket.'}
    ));
    exit()
  }
  else {
	  window.addEventListener("load", onLoad, false);
  }
  
function onLoad() {
	statust.innerHTML = "Connecting";
	connection = new WebSocket('ws://172.16.17.204:1338');
	connection.onopen = function(evt) { onOpen(evt) };
	connection.onerror = function(evt) { onError(evt) };
	connection.onmessage = function(evt) { onError(evt) };
	setInterval(function() {
    if (connection.readyState !== 1) {
      statust.innerHTML = "Connection Timeout";
      console.log('Connection Timeout');
    }
  }, 3000);
};
  
  function onOpen(evt) {
    statust.innerHTML = "Connected";
  };
  
  function onError(evt) {
    content.html($('<p>', {
      text: 'Sorry, but there\'s some problem with your connection or the server is down.'
    }));
  };
  
  function onMessage(evt) {
      console.log('Got a message:', message);
  };
 



  function clickFun(channel,command){
	  if (connection.readyState == 1) {
		  connection.send(channel + ':' + command);
		  statust.innerHTML = "Sent";
	      console.log('Got Click');
	  }
	  else {
		  console.log('Got Click, connection not ready');
		  statust.innerHTML = "Connection Error";
	  }
  };

    </script>
  </body>
</html>
